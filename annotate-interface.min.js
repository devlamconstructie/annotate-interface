const a={types:["underline","highlight","box","circle","bracket","strike-through","crossed-off"],groupPrefix:"grouped-",defaultType:1,defaultColor:"#F37D30",defaultStrokeWidth:2,defaultIterations:1,defaultPadding:[5,5,5,5]};const s=()=>{const t={};t.underline={type:"underline",color:"#F37D30",strokeWidth:3,iterations:2,padding:1};t.highlight={type:"highlight",color:"#D2D700",iterations:1};t.box={type:"box",color:"#F37D30",padding:3};t.circle={type:"circle"};t.bracket={type:"bracket",color:"red",strokeWidth:2,padding:[2,5],brackets:["left","right"]};t.strikeThrough={type:"strike-through",multiline:true};t.crossedOff={type:"crossed-off"};return t};const t=()=>{if(typeof RoughNotation==="undefined"){console.error("roughNotation is not loaded.");return}const i=RoughNotation.annotate;const o=RoughNotation.annotationGroup;const t=document.querySelectorAll(".annotate");console.debug(`found ${t.length} annotate elements`);if(t.length===0){return}const r=[];const l=s();t.forEach(e=>{let t;let o="";[o]=a.types.filter(t=>e.classList.contains(t));if(o!==undefined){o=o.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()});const s=l[o];if(e.classList.contains("multiline")){if(g(e)==="inline"){s.multiline=!!e.classList.contains("multiline")}else{console.log("multiline only works on inline type elements (spans, anchors, etc) not on blocks")}}t=i(e,s)}else{const s={};s.type=e.dataset.type||a.types[a.defaultType];s.color=e.dataset.color||a.defaultColor;s.strokeWidth=e.dataset.strokeWidth||a.defaultStrokeWidth;s.iterations=e.dataset.iterations||a.defaultIterations;s.padding=e.dataset.padding||a.defaultPadding;s.brackets=e.dataset.brackets||["left","right"];t=i(e,s)}const n=d(e);if(n===false){f(e,t)}else{u(e,t)}r.push(t)});const e=c();const n=[];e.forEach((t,e)=>{n.push(o(t.annotations));h(e)})};const c=()=>{if(typeof c.list==="undefined"){c.list=new Map}return c.list};const d=t=>{const e=new RegExp(`/${a.groupPrefix}[\w\-]+/`);let o=false;for(const n of t.classList){if(n.match(e)!==null){o=n}}return o};const u=(t,e,o="")=>{if(!o){o=d(t)}if(!o){console.debug("element does not belong in a group or something went wrong.");return false}const n=c();const s=n.get(o)||[];n.set(o,{members:[t,...s.members],annotations:[e,...s.annotations]})};const f=(t,e,o={threshold:1})=>{const n=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting||t.intersectionRatio){e.show()}})},o);n.observe(t)};const h=(t,e,o={threshold:1})=>{const n=new IntersectionObserver(t=>{if(t.isIntersecting&&e._state==="not-showing"){e.show()}},o);const s=document.querySelectorAll(t);if(s.length===0){console.debug(`found items to observe with ${t}: ${s.length}`)}s.forEach(t=>{n.observe(t)})};const g=t=>{const e=t.currentStyle||window.getComputedStyle(t,"");return e.display};window.onload=t;window.onresize=t;
